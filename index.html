<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>青灡居成本与进展管理</title>
  <!-- 添加空favicon避免404错误 -->
  <link rel="icon" href="data:;base64,=">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      background-color: #f9fafb; 
      color: #1f2937; 
      margin: 0;
      padding: 0;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .card { background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 20px; margin-bottom: 20px; }
    .btn { display: inline-block; padding: 8px 16px; border-radius: 4px; text-decoration: none; }
    .btn-primary { background: #3b82f6; color: white; }
    .btn-danger { background: #ef4444; color: white; }
  </style>
</head>
<body>
  <div id="root" class="container"></div>
  <script>
    // 确保这是一个独立的代码块，没有多余字符
    (function() {
      'use strict';
      
      // 获取React hooks
      var useState = React.useState;
      var useEffect = React.useEffect;
      
      // Firebase 配置
      var firebaseConfig = {
        apiKey: "AIzaSyAXlAEJUHEagJ3GDHIFfJV9AnAAPAIAC8g",
        authDomain: "qinglanju-9ca26.firebaseapp.com",
        databaseURL: "https://qinglanju-9ca26-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "qinglanju-9ca26",
        storageBucket: "qinglanju-9ca26.firebasestorage.app",
        messagingSenderId: "172568618102",
        appId: "1:172568618102:web:6887b8d89cc894c9642b57"
      };

      // 初始化 Firebase
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }
      var auth = firebase.auth();
      var db = firebase.database();

      // 管理员邮箱
      var ADMIN_EMAILS = ["admin@qinglanju.com", "manager@qinglanju.com"];

      // 主应用组件
      function App() {
        var _useState = useState(null);
        var user = _useState[0];
        var setUser = _useState[1];
        
        var _useState2 = useState(true);
        var loading = _useState2[0];
        var setLoading = _useState2[1];

        useEffect(function() {
          var unsubscribe = auth.onAuthStateChanged(function(user) {
            setUser(user);
            setLoading(false);
          });
          return function() {
            return unsubscribe();
          };
        }, []);

        if (loading) {
          return React.createElement("div", { className: "card" }, "加载中...");
        }

        if (!user) {
          return React.createElement(AuthPage, { setUser: setUser });
        }

        return React.createElement(MainApp, { 
          user: user, 
          onLogout: function() { 
            return auth.signOut(); 
          } 
        });
      }

      // 登录页面
      function AuthPage(props) {
        var _useState3 = useState('');
        var email = _useState3[0];
        var setEmail = _useState3[1];
        
        var _useState4 = useState('');
        var password = _useState4[0];
        var setPassword = _useState4[1];
        
        var _useState5 = useState('');
        var error = _useState5[0];
        var setError = _useState5[1];

        var handleSubmit = function(e) {
          e.preventDefault();
          setError('');
          
          auth.signInWithEmailAndPassword(email, password)
            .then(function() {
              // 登录成功
            })
            .catch(function(err) {
              setError(err.message);
            });
        };

        return React.createElement("div", { className: "card" }, 
          React.createElement("h1", { className: "text-2xl font-bold mb-4" }, "登录"),
          error && React.createElement("p", { className: "text-red-500 mb-4" }, error),
          React.createElement("form", { onSubmit: handleSubmit }, 
            React.createElement("div", { className: "mb-4" }, 
              React.createElement("label", { className: "block text-sm font-medium mb-1" }, "邮箱"),
              React.createElement("input", { 
                type: "email", 
                value: email, 
                onChange: function(e) { setEmail(e.target.value); }, 
                className: "w-full border rounded p-2",
                required: true 
              })
            ),
            React.createElement("div", { className: "mb-4" }, 
              React.createElement("label", { className: "block text-sm font-medium mb-1" }, "密码"),
              React.createElement("input", { 
                type: "password", 
                value: password, 
                onChange: function(e) { setPassword(e.target.value); }, 
                className: "w-full border rounded p-2",
                required: true 
              })
            ),
            React.createElement("button", { 
              type: "submit", 
              className: "btn btn-primary" 
            }, "登录")
          ),
          React.createElement("div", { className: "mt-4 text-sm text-gray-500" }, 
            React.createElement("p", null, "示例账号："),
            React.createElement("p", null, "admin@qinglanju.com / 123456")
          )
        );
      }

      // 主应用页面
      function MainApp(props) {
        var user = props.user;
        var onLogout = props.onLogout;
        
        return React.createElement("div", { className: "card" }, 
          React.createElement("div", { className: "flex justify-between items-center mb-4" }, 
            React.createElement("h1", { className: "text-xl font-bold" }, "青灡居成本管理"),
            React.createElement("div", { className: "flex items-center gap-2" }, 
              React.createElement("span", null, user.email),
              React.createElement("button", { 
                onClick: onLogout, 
                className: "text-red-500" 
              }, "退出")
            )
          ),
          React.createElement("div", { className: "text-center py-8" }, 
            React.createElement("p", { className: "text-lg mb-4" }, "欢迎回来，", user.email, "！"),
            React.createElement("p", null, "功能已就绪，可管理项目、明细和进度。")
          )
        );
      }

      // 关键修复：使用纯JavaScript语法，避免JSX
      try {
        var container = document.getElementById('root');
        if (container) {
          var root = ReactDOM.createRoot(container);
          root.render(React.createElement(App, null));
        }
      } catch (err) {
        console.error('渲染失败:', err);
        var rootDiv = document.getElementById('root');
        if (rootDiv) {
          rootDiv.innerHTML = "<div class=\"p-8 text-red-500 text-center\">应用加载失败: " + err.message + "</div>";
        }
      }
    })();
  </script>
</body>
</html>
